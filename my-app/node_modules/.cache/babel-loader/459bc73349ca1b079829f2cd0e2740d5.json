{"ast":null,"code":"var _jsxFileName = \"/root/ms1/my-app/src/Editor.js\",\n  _s = $RefreshSig$();\nimport * as Y from 'yjs';\nimport { QuillBinding } from 'y-quill';\nimport Delta from \"quill-delta\";\nimport Quill from 'quill';\nimport QuillCursors from 'quill-cursors';\nimport { useCallback, useEffect, useState } from 'react';\nimport \"./styles.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Editor(props) {\n  _s();\n  // A Yjs document holds the shared data\n  const ydoc = new Y.Doc();\n  const ytext = ydoc.getText('quill');\n  console.log(ytext.toString());\n  var ops;\n\n  // EventSource stuff in here\n  const events = new EventSource(`http://194.113.75.203:3001/api/connect/${props.docId}`);\n\n  // The \"sync\" event's data should replace the document contents in the UI.\n  events.addEventListener('sync', event => {\n    console.log(\"In sync\");\n    var data = JSON.parse(event.data);\n    console.log(data); //<- our data from the backend is here\n    ytext.applyDelta(data);\n    ops = data;\n    console.log(ytext.toString() + \" i hate my\");\n    //setYText(event.data); \n  });\n\n  // The \"update\" event's data should be used to apply CRDT changes sent by the server\n  events.addEventListener('update', event => {\n    console.log(\"In update\");\n    console.log(event.data);\n    //ytext.applyDelta(delta)\n    //update crdt obj (which in this case would b y doc)\n  });\n\n  const wrapperRef = useCallback(wrapper => {\n    if (wrapper == null) return;\n    wrapper.innerHTML = \"\";\n    Quill.register('modules/cursors', QuillCursors);\n    const quill = new Quill(document.querySelector('#editor'), {\n      modules: {\n        cursors: true,\n        toolbar: [],\n        history: {\n          userOnly: true\n        }\n      },\n      placeholder: 'Start collaborating...',\n      theme: 'snow'\n    });\n    quill.setContents(ops);\n    //Create an editor-binding which\n    //\"binds\" the quill editor to a Y.Text type.\n    quill.on('text-change', function (delta, oldDelta, source) {\n      console.log(JSON.stringify(delta.ops));\n      fetch(`http://194.113.75.203:3001/api/op/${props.docId}`, {\n        method: 'POST',\n        headers: {\n          Accept: \"application/json\",\n          \"Content-Type\": \"application/json\",\n          \"Access-Control-Allow-Origin\": \"*\"\n        },\n        body: JSON.stringify(delta.ops)\n      });\n    });\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"editor\",\n    className: \"container\",\n    ref: wrapperRef\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 12\n  }, this);\n}\n_s(Editor, \"Ckff4P1tSXuKx/UN+CqhszMFSy0=\");\n_c = Editor;\nexport default Editor;\nvar _c;\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"names":["Y","QuillBinding","Delta","Quill","QuillCursors","useCallback","useEffect","useState","Editor","props","ydoc","Doc","ytext","getText","console","log","toString","ops","events","EventSource","docId","addEventListener","event","data","JSON","parse","applyDelta","wrapperRef","wrapper","innerHTML","register","quill","document","querySelector","modules","cursors","toolbar","history","userOnly","placeholder","theme","setContents","on","delta","oldDelta","source","stringify","fetch","method","headers","Accept","body"],"sources":["/root/ms1/my-app/src/Editor.js"],"sourcesContent":["import * as Y from 'yjs'\nimport { QuillBinding } from 'y-quill'\nimport Delta from \"quill-delta\";\nimport Quill from 'quill'\nimport QuillCursors from 'quill-cursors'\nimport { useCallback, useEffect, useState } from 'react'\nimport \"./styles.css\"\n\nfunction Editor(props) {                                                                                                                                                       \n\n    // A Yjs document holds the shared data\n    const ydoc = new Y.Doc()\n    const ytext = ydoc.getText('quill')\n    console.log(ytext.toString())\n    var ops;\n\n    // EventSource stuff in here\n    const events = new EventSource(`http://194.113.75.203:3001/api/connect/${props.docId}`)\n\n    // The \"sync\" event's data should replace the document contents in the UI.\n    events.addEventListener('sync', (event) => {\n        console.log(\"In sync\");\n        var data = JSON.parse(event.data)\n        console.log(data) //<- our data from the backend is here\n        ytext.applyDelta(data)\n        ops = data;\n        console.log(ytext.toString() + \" i hate my\")\n        //setYText(event.data); \n    });\n\n    // The \"update\" event's data should be used to apply CRDT changes sent by the server\n    events.addEventListener('update', (event) => {\n        console.log(\"In update\");\n        console.log(event.data)\n        //ytext.applyDelta(delta)\n        //update crdt obj (which in this case would b y doc)\n    });\n\n    const wrapperRef = useCallback((wrapper) => {\n        if (wrapper == null) return\n        wrapper.innerHTML = \"\"\n        Quill.register('modules/cursors', QuillCursors)\n        const quill = new Quill(document.querySelector('#editor'), {\n            modules: {\n                cursors: true,\n                toolbar: [],\n                history: {\n                    userOnly: true\n                }\n            },\n            placeholder: 'Start collaborating...',\n            theme: 'snow'\n        })\n        quill.setContents(ops)\n        //Create an editor-binding which\n        //\"binds\" the quill editor to a Y.Text type.\n        quill.on('text-change',function(delta, oldDelta, source) {\n            console.log(JSON.stringify(delta.ops))\n            fetch(`http://194.113.75.203:3001/api/op/${props.docId}`, \n               { method: 'POST',\n               headers: {\n                Accept: \"application/json\",\n                \"Content-Type\": \"application/json\",\n                \"Access-Control-Allow-Origin\": \"*\",\n              },\n               body: JSON.stringify(delta.ops)})\n        });\n\n    }, [])\n\n    return <div id='editor' className='container' ref={wrapperRef}></div>\n}\n\nexport default Editor;"],"mappings":"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"},"metadata":{},"sourceType":"module"}